---
title: "Clase Final de Programación"
author: "Flavio"
format:
  html:
    toc: true
    toc-expand: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    self-contained: true
    code-fold: true
    output-file: "ESM"
editor_options: 
  chunk_output_type: console
execute: 
  warning: false
  message: false
  echo: true
---

# Project Setup

```{r}
#| label:  setup

source('https://inkaverse.com/setup.r')
```

# Data import

```{r}
gs <- "https://docs.google.com/spreadsheets/d/15r7ZwcZZHbEgltlF6gSFvCTFA-CFzVBWwg3mFlRyKPs/edit?gid=172957346#gid=172957346" %>% 
  as_sheets_id()

fb <- gs %>% 
  range_read(ss = .,sheet = "fb")
```

## Barplot HI

```{r}
md <- aov(hi ~ geno*riego + bloque, fb)
anova(md)

mc <- emmeans(md, ~ geno*riego) %>% 
  cld(Letters = letters, decreasing = TRUE)

p1 <- ggplot(mc, aes(x = geno, y = emmean, fill = riego)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), position = position_dodge(width = 0.9), width = 0.2) +
  labs(y = "Indice de Cosecha") +
  scale_y_continuous(limits = c(0, 1.2), breaks = seq(0, 1.2, 0.2))

p1
```

## Grafico de lineas lfa

```{r}
md <- aov(lfa ~ geno*riego + bloque, fb)
anova(md)

mc <- emmeans(md, ~ geno*riego) %>% 
  cld(Letters = letters, decreasing = TRUE)

p2 <- ggplot(mc, aes(x = geno, y = emmean, color = riego, group = riego)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), width = 0.2) 
p2
```

## boxplot de rwc_84

```{r}
p3 <- ggplot(fb, aes(x = geno, y = rwc_84, fill = riego)) +
  geom_boxplot() +
  labs(x = "Genotipo", y = "RWC_84")

p3
```

## Regresion lienas de hi vs twue

De la base de datos fb, hacer una grafico de regresion lineal entre hi y twue. Agrupar por tipo de riego.

```{r}
p4 <- ggplot(fb, aes(x = hi, y = twue, color = riego)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "HI", y = "TWUE")

p4
```

## Imagenes en grids

```{r}
pt <- "potato.jpg" %>% 
  image_read() %>% 
  image_ggplot()


plot <- list(p1, p2, p3, p4) %>% 
  plot_grid(plotlist = ., ncol = 2, labels = "auto") %>% 
  plot_grid(plotlist = pt, ncol = 2, rel_widths = c(3, 1)
            , labels = c("", "e")) %>% 
  ggsave(plot = ., "Figura-1.jpg"
         , units = "cm"
         , width = 35
         , height = 15
         )

include_graphics(plot)
```

# References

Broman, K. W., & Woo, K. H. (2017). Data organization in spreadsheets. The American Statistician, 72(1), 2–10. https://doi.org/10.1080/00031305.2017.1375989

Zuur, A. F., Ieno, E. N., & Elphick, C. S. (2009). A protocol for data exploration to avoid common statistical problems. Methods in Ecology and Evolution, 1(1), 3–14. https://doi.org/10.1111/j.2041-210x.2009.00001.x

Francoishusson. (2017, July 13). PCA course using FactoMineR | R-bloggers. R-bloggers. https://www.r-bloggers.com/2017/07/pca-course-using-factominer/

Kozak, M., & Piepho, H. (2017). What’s normal anyway? Residual plots are more telling than significance tests when checking ANOVA assumptions. Journal of Agronomy and Crop Science, 204(1), 86–98. https://doi.org/10.1111/jac.12220

Tanaka, E., & Hui, F. K. C. (2019). Symbolic formulae for linear mixed models. In Communications in computer and information science (pp. 3–21). https://doi.org/10.1007/978-981-15-1960-4_1

Schielzeth, H., Dingemanse, N. J., Nakagawa, S., Westneat, D. F., Allegue, H., Teplitsky, C., Réale, D., Dochtermann, N. A., Garamszegi, L. Z., & Araya‐Ajoy, Y. G. (2020). Robustness of linear mixed‐effects models to violations of distributional assumptions. Methods in Ecology and Evolution, 11(9), 1141–1152. https://doi.org/10.1111/2041-210x.13434